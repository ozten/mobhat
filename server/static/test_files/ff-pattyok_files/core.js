/* Copyright 2009 FriendFeed */

var clickHandlers={};var mouseoverHandlers={};var mouseoutHandlers={};$(function(){if(window.recordTime){recordTime("start core init")}bindEvents("click");if(!window.gIphoneMode){bindEvents("mouseover");bindEvents("mouseout");$(".sharebox textarea").hint()}delayHideAlert();if(!window.gIphoneMode){$("body").mousedown(function(D){for(var C=D.target;C;C=C.parentNode){if(C.tagName=="A"){if(C.className.match(/l_/)||(document.location.href.split("#")[0]+"#")==C.href){return }if(window.gNewWin){var E=C.href.indexOf("//"+document.location.host+"/");if(E==-1||E>6){C.target="_blank"}}savePageHtml();return }}})}var B=(new Date()).getTimezoneOffset();try{document.cookie="T="+B+"; expires=Tue, 31 Dec 2030 20:47:11 UTC; path=/"}catch(A){}if(window.gFacebookParams){window.gFacebookParams+="&tz="+B;$("body").submit(function(D){var C=D.target;if(isFriendFeed(C.action)){C.action=addFBParams(C.action);C.target="_self"}})}gKillClick=false;if(window.fileUploader&&!window.gIphoneMode){setTimeout(function(){fileUploader.load()},200)}if(!window.gIphoneMode){if(window.recordTime){recordTime("about to ellipsify")}$("#sidebar a.l_room").ellipsify();if(window.recordTime){recordTime("done core init")}}});var delayTimeout=null;function delayHideAlert(){var B=$("#alertmessage");if(B.length>0){if(delayTimeout){clearTimeout(delayTimeout)}var A=B.find("a").length>0?8000:4000;delayTimeout=setTimeout(function(){delayTimeout=null;B.slideUp(200,function(){B.remove()})},A)}}function rtl(){return window.gRTL?"-rtl":""}function createFlashObj(C,A){var B=document.createElement("div");B.style.width="1px";B.style.height="1px";document.getElementsByTagName("body")[0].appendChild(B);if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){B.innerHTML='<embed type="application/x-shockwave-flash" src="'+A+'" width="1px" height="1px" id="'+C+'" name="'+C+'" bgcolor="white" quality="high" menu="false"/>'}else{B.innerHTML='<object id="'+C+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1px" height="1px"><param name="movie" value="'+A+'"><param name="bgcolor" value="white"/><param name="quality" value="high"/><param name="menu" value="false"/></object>'}}jQuery.fn.ellipsify=function(){for(var A=0;A<this.length;A++){var B=this[A].offsetParent.offsetWidth;var C=(window.gRTL?-this[A].offsetLeft:this[A].offsetLeft)+this[A].offsetWidth;if(B<C){var D=$(this[A]);var E=D.text();E=E.substring(0,Math.min(E.length-3,7+E.length*B/C));while(true){E=$.trim(E);D.text(E+"...");C=(window.gRTL?-this[A].offsetLeft:this[A].offsetLeft)+this[A].offsetWidth;if(B>=C){break}E=E.substring(0,Math.min(E.length-1,0.5+E.length*B/C))}}}};function isFriendFeed(A){return A.charAt(0)=="/"||A.match(new RegExp("^https?://"+document.location.host+"/"))}function addFBParams(A){if(!window.gFacebookParams||!isFriendFeed(A)){return A}return A+(A.indexOf("?")!=-1?"&":"?")+gFacebookParams}function handleFBClick(C){if(!window.gFacebookParams){return }var B=C.target;for(;;B=B.parentNode){if(!B){return }if(B.tagName=="A"){break}}var A=B.href;if($(B).hasClass("noframe")){B.target="_blank"}if(!A||A.indexOf("#")!=-1||!isFriendFeed(A)){return }if(B.onclick||$(B).hasClass("noframe")){return }document.location.href=addFBParams(A);return true}function bindEvents(A){var B=window[A+"Handlers"];$("body")[A](function(F){if(A=="click"&&handleFBClick(F)){return false}for(var E=F.target;E;E=E.parentNode){if(!E.className){continue}if(A=="click"&&F.target.tagName!="A"&&E.className.match(/\btab\b/)){if(tabClick($(E))){return false}}var C=E.className.match(/\bl_([\w]+)\b/);if(!C){continue}var D=B[C[1]];if(!D){continue}if(A=="click"){$(E).blur();return D($(E),F)?undefined:false}else{D($(E),F);return }}if(!window.gIphoneMode&&A=="click"){$.closePopupMenu();popup.hide()}})}function tabClick(B){var A=B.find("a").attr("href");if(!A){return false}location.href=A;return true}function setLocale(A){submitForm("/a/setlocale",{locale:A})}jQuery.postJSON=function(url,data,opt_callback,opt_loadingElement,opt_loadingLeft){if(opt_loadingElement){showSpinner(opt_loadingElement,opt_loadingLeft)}data.at=getCookie("AT");var body=$.param(data);if(window.gFacebookParams&&url.charAt(0)=="/"){body+="&"+window.gFacebookParams}if(window.gIphoneMode){body+="&_iphone=1"}dprint(url);$.ajax({url:url,data:body,dataType:"text",type:"POST",success:function(response){if(opt_loadingElement){hideSpinner()}if(opt_callback){opt_callback(eval("("+response+")"))}}})};jQuery.fn.formToDict=function(){var A=this.serializeArray();var C={};for(var B=0;B<A.length;B++){C[A[B].name]=A[B].value}return C};jQuery.fn.disable=function(){this.attr("disabled","disabled");return this};jQuery.fn.enable=function(A){if(arguments.length&&!A){this.attr("disabled","disabled")}else{this.removeAttr("disabled")}return this};jQuery.fn.center=function(H,A,E){var B=windowSize();var F=E?{x:0,y:0}:scrollPos();for(var D=0;D<this.length;D++){var G=Math.max(0,B.width-this[D].offsetWidth);var C=Math.max(0,B.height-this[D].offsetHeight);$(this[D]).css({top:F.y+C*(A!==undefined?A:0.5),left:F.x+G*(H!==undefined?H:0.5)})}return this};jQuery.fn.makeExpandable=function(A,D,C){var B=C||"5em";this.keypress(function(F){if(F.keyCode==13&&D){D(this);return false}if(this.value.length>=A&&F.charCode>8&&F.charCode<63200){return false}if(this.style.height!=B){var E=this;setTimeout(function(){if(E.value.indexOf("\n")!=-1||E.scrollTop>0||E.scrollLeft>0||E.scrollHeight>E.offsetHeight){E.style.height=B;if(window.updateFrameSize){window.updateFrameSize()}}},10)}});return this};jQuery.fn.hint=function(){return this.each(function(){var A=$(this);var B=A.attr("title");if(!B){return }A.blur(function(){if(!A.val()||A.val()==B){A.addClass("blur");A.val(B)}});A.focus(function(){if(A.val()==B){A.val("")}A.removeClass("blur")});A.parents("form:first()").submit(function(){if(A.val()==B){A.val("");A.removeClass("blur")}});A.blur()})};jQuery.fn.dialog=function(A,E){$.closeDialog();A=A||0.6;E=E||100000;var C="position:fixed;";if($.browser.msie&&$.browser.version<7){C="position:absolute;"}var B=$('<div class="dialogdiv" style="z-index:'+E+"; width:100%; height:100%; top:0; left:0; "+C+' background-color:black"></div>');B.css("opacity",A);var D=$('<div class="dialogdiv" style="z-index:'+E+"; "+C+'"></div>');D.append(this);B.click($.closeDialog);$([B,D]).appendTo(document.body);D.center(0.5,0.5,true);return this};jQuery.closeDialog=function(){$(".dialogdiv").remove()};clickHandlers.closedialog=jQuery.closeDialog;jQuery.fn.popupMenu=function(B){if($(".popupmenu:visible").attr("menuLink")==B[0]){$.closePopupMenu();return }$.closePopupMenu();var C=B.offset();var A=B.height();this.css({position:"absolute",left:(C.left-4)+"px",top:(C.top+A+3)+"px"});this.appendTo(document.body);this.show();var D=$('<div class="popupshadow"></div>').css({position:"absolute",left:(C.left-2)+"px",top:(C.top+A+5)+"px",width:this.width()+8,height:this.height()+8,backgroundColor:"black",opacity:0.4,zIndex:9999}).appendTo(document.body);this.find("a").not(".menuified").addClass("menuified").click(function(){setTimeout($.closePopupMenu,100)});this.attr("menuLink",B[0])};jQuery.closePopupMenu=function(){$(".popupmenu.permanent").hide();$(".popupmenu").not(".permanent").remove();$(".popupshadow").remove()};jQuery.fn.autoCompleteSubscriptions=function(B){loadAutoComplete();var A=this;function C(){if(window.acScriptLoaded){A.autocompleteArray(window.acSubscriptions,{delay:10,minChars:1,matchSubset:1,matchWord:1,autoFill:false,selectFirst:true,maxItemsToShow:10})}else{setTimeout(C,50)}}if(window.acSubscriptions){C()}else{$.postJSON("/a/subscriptions",{includerooms:B?"1":""},function(D){window.acSubscriptions=D.friends;C()})}return this};function loadAutoComplete(){if(!window.acScriptStarted&&!window.acScriptLoaded){window.acScriptStarted=true;var A=document.createElement("script");A.setAttribute("type","text/javascript");A.setAttribute("src","/static/javascript/autocomplete.js?v=2");document.body.appendChild(A)}}clickHandlers.refreshfeed=function(A){$.postJSON("/a/crawlservice",{serviceid:A.attr("serviceid"),stream:A.attr("streamid")},function(B){$(".serviceloading").hide();$(".feed").html(B.html)});A.remove();$(".serviceloading").show()};function configureService(C,A){var B=$(".editservices").find("table:first");C.find(".error").hide();C.find("input[type='submit']").disable();$(".serviceloading").hide();$(".feed").empty();$.postJSON("/a/configureservice",$.extend({refresh:A?1:""},C.formToDict()),function(D){if(D.error){C.find(".error:last").html(D.error).show();C.find("input[type='submit']").enable();return }if(D.replace_html){$(".editservices").replaceWith(D.replace_html);return }if(window.gNextUrl){document.location=window.gNextUrl;return }$(".editservices").replaceWith(D.html);$(".serviceloading").show();$.postJSON("/a/crawlservice",{stream:D.stream,serviceid:D.serviceid},function(E){$(".serviceloading").hide();$(".feed").html(E.html)})},B);return false}function removeServiceDialog(B){var A=$(['<div id="dialog"><form method="post">','<div><input type="checkbox" id="alsoremove"/><label for="alsoremove">','Also delete imported entries',"</label></div>",'<div class="buttons"><input type="submit" class="save"> ','<a href="#" class="l_closedialog">Cancel</a></div></form></div>'].join(""));A.find("input[type=submit]").val('Remove %(service)s'.replace("%(service)s",B.attr("service_name")));A.find("form").submit(function(){A.find("input[type=submit]").disable();removeService(B.parents("form"),$("#alsoremove").get(0).checked);return false});A.dialog()}function removeService(B,A){$.postJSON("/a/removeservice",$.extend({deleteentries:A?1:""},B.formToDict()),function(C){$(".editservices").replaceWith(C.html);$.closeDialog();var E=$('<div id="infomessage" style="margin-bottom: 0.5em;"></div>');E.text('%(service)s removed'.replace("%(service)s",C.service_full_name)+" - ");var D=$('<a href="#">'+'Undo'+"</a>");D.click(function(){for(var F in C){if(C[F]==null){delete C[F]}}$.postJSON("/a/configureservice",C,function(G){$(".editservices").replaceWith(G.html)})});E.append(D);$(".editservices td.lhs").prepend(E)});return false}function _(A){return A}function now(){return(new Date()).getTime()}function bind(A,B){if(typeof (B)=="string"){B=A[B]}return function(){return B.apply(A,arguments)}}function dprint(A){if(window.console&&window.console.log){window.console.log(A)}}function dtimer(){return function(){}}function windowSize(){var C=document.documentElement;var A=(window.innerWidth||self.innerWidth||(C&&C.clientWidth)||document.body.clientWidth);var B=(window.innerHeight||self.innerHeight||(C&&C.clientHeight)||document.body.clientHeight);return{width:A,height:B}}function scrollPos(){if(self.pageYOffset!==undefined){return{x:self.pageXOffset,y:self.pageYOffset}}var A=document.documentElement;return{x:A.scrollLeft,y:A.scrollTop}}function getCookie(A){var B=document.cookie.match("\\b"+A+"=([^;]*)\\b");return B?B[1]:undefined}function shareSubmit(C){var D=$("#"+C.parents(".sharebox").attr("feedid"));var E=window.gFeedSpecs||{};var A=$.extend(C.formToDict(),E[D.attr("id")]);if(!A.title||A.title==C.find("textarea.sharetitle").attr("title")){C.find("textarea.sharetitle").select().focus();return false}if(typeof (realtime)!="undefined"){A.token=realtime.token}C.find(":submit").disable();var B=C.parents(".sharebox").find("table:first");if(C.find("div.photo").length>0){showSpinner(B);C.submit();return false}delete A.next;$.postJSON("/a/share",A,function(F){if(typeof (A.token)=="undefined"){if(F.html){D.html(F.html)}}else{realtime.queuePush(F.html);realtime.queueUpdated()}$(".noentries").remove();var G=C.parents(".sharebox");G.find(".expando").slideUp(100);clearShareBox(G);G.find("textarea").val("").blur()},B);return false}function commentSubmit(B){var C=!!B.find(".twitbox input[type=checkbox]").attr("checked");var A=$.extend({entry:B.parents(".entry").attr("eid"),stream:B.parents(".cluster").attr("sid"),tweet:C},B.formToDict());if(!A.body){B.find("textarea").select();return false}B.find(".l_cancelcomment").text("");B.find("input[type='submit']").disable();$.postJSON("/a/comment",A,function(D){B.parents(".commentform").replaceWith(D.html)},B.find(".l_cancelcomment"));return false}function commentEditSubmit(C){var A=C.parents(".commentform").parent().prev(".hiddencomment");var B=$.extend({entry:C.parents(".entry").attr("eid"),stream:C.parents(".cluster").attr("sid"),comment:A.attr("cid")},C.formToDict());if(!B.body){C.find("textarea").select();return false}C.find(".l_cancelcomment").text("");C.find("input[type='submit']").disable();$.postJSON("/a/editcomment",B,function(D){A.remove();C.parents(".commentform").replaceWith(D.html);C.parents(".commentform").css("background-color","yellow")},C.find(".l_cancelcomment"));return false}function friendListNameSubmit(A){A.find("input[type='submit']").disable();$.postJSON("/a/friendlistname",A.formToDict(),function(B){$("h1 a").text(B.name_html);$("h1").show();A.remove()},A.find("a:last"));return false}function like(B,A,C){$.postJSON("/a/like",{entry:B.attr("eid"),stream:B.parents(".cluster").attr("sid"),"delete":A||""},function(D){var E=B.find(".likes");if(E.length>0){E.replaceWith(D.html)}else{$(D.html).insertAfter(B.find(".info"))}if(!A){B.find(".like").hide()}else{B.find(".like").show()}},C)}function showSpinner(B,A){if(B&&B.length>0){hideSpinner();var E=B.offset();var C=B.width();var D=A?E.left-21:E.left+C+5;loader=$('<div id="loadingspinner" style="width: 16px; height: 16px; position: absolute; top: '+E.top+"px; left: "+D+'px; z-index:200000"><img src="/static/images/loading.gif?v=1" width="16" height="16" alt="'+'Loading...'+'"/></div>');$(document.body).append(loader)}}function hideSpinner(){$("#loadingspinner").remove()}function checkRequired(D,B){var E=true;for(var C=0;C<B.length;C++){var A=D[B[C]];if(!A){continue}if(!A.value||A.className.indexOf("blur")!=-1){$(A).addClass("required");if(E){A.select()}E=false}else{$(A).removeClass("required")}}return E}function multiFileUpload(shareBox){var url="/a/upload?c="+escape(getCookie("U"));fileUploader.showFileDialog(url,{start:function(file){var progress=$('<tr id="progress'+file.id+'"><td class="name"></td><td><div class="bar"><div class="percentage" style="width:1%"></div></div></td><td class="loading"><img src="/static/images/share-loading.gif?v=5" width="16" height="16"/></td><td class="message"></td></tr>');progress.find(".name").text(file.name);shareBox.find("div.progress table").append(progress);shareBox.find("input[type='submit']").disable()},progress:function(file,bytes,total){var progress=$("#progress"+file.id);var percentage=Math.round(100*bytes/total);progress.find(".bar .percentage").css("width",percentage+"%");if(percentage==100){progress.find(".message").text('processing image')}},complete:function(file,data){$("#progress"+file.id).remove();var response=eval("("+data+")");var thumbnails=shareBox.find(".thumbnails");if(thumbnails.length==0){thumbnails=$('<div class="thumbnails"><table><tr><td></td></tr></table></div>');thumbnails.insertAfter(shareBox.find(".progress"))}var thumb=$('<a href="#" title="'+'Click to remove image'+'"><img src="'+response.thumbnail.url+'" width="'+response.thumbnail.width+'" height="'+response.thumbnail.height+'"/></a>');thumbnails.find("td").append(thumb);if(fileUploader.numActiveUploads()==0){shareBox.find("input[type='submit']").enable()}var form=shareBox.find("form");var numHidden=0;form.find("input[type='hidden']").each(function(i,input){if(isMultiFileField(input)&&input.name.substr(input.name.length-4)=="_url"){numHidden++}});thumb.click(function(){form.find("input[name='image"+numHidden+"_url']").remove();thumb.remove();return false});var values={url:response.image.url,type:response.image.type,title:response.image.name,thumb:response.thumbnail.url,thumbwidth:response.thumbnail.width,thumbheight:response.thumbnail.height};for(var name in values){$('<input type="hidden" name="image'+numHidden+"_"+name+'"/>').val(values[name]).appendTo(form)}shareBox.find("textarea.sharetitle").css({width:shareBox.find(".expando").width()})},error:function(file){var progress=$("#progress"+file.id);progress.find(".loading,.bar").css("display","none");progress.find(".message").text('could not upload');progress.addClass("error");if(fileUploader.numActiveUploads()==0){shareBox.find("input[type='submit']").enable()}}},[{extensions:"*.jpg;*.gif;*.png;*.jpeg",description:"Images (*.jpg, *.gif, *.png, *.jpeg)"}])}function isMultiFileField(A){return A.name.substr(0,5)=="image"}function clearShareBox(A){A.find("input[type='text']").val("");A.find("textarea").removeAttr("style");A.find(":submit").enable();A.find("div.comment,div.link,div.photo,div.promo").hide(100,function(){A.find("div.photo").remove()});A.find("input[type='hidden']").each(function(C,B){if(isMultiFileField(B)){$(B).remove()}});A.find(".thumbnails").remove();A.find(".progress table tr").remove();A.find("a.l_attachcomment,a.l_attachlink").show()}function addFriendListSubmit(B){var A=$.extend(gFeedSpecs.feed1,B.formToDict());if(!A.nicknames){B.find("input.nicknames").select();return false}var C=B.find("input[type='submit']");C.disable();$.postJSON("/a/addtofriendlist",A,function(D){updateFriendList(B.parents(".friendchooser"),D)},B.parents("div.t:first"));return false}function friendListPersonOver(){$(this).find(".delete").show()}function friendListPersonOut(){$(this).find(".delete").hide()}function highlightText(B,C){if(!C){return }var A=new RegExp("\\b"+C.replace("\\","\\\\")+"\\b","gi");B.each(function(D,E){highlightNode(E,C,A)})}function highlightNode(D,J,M){if(D.nodeType==3){var K=D.nodeValue;if(K.length<J.length){return }var H=[];M.lastIndex=0;while(true){var N=M.exec(K);if(!N){break}H.push(N.index)}if(H.length==0){return }var E=[];var L=0;var C=document.createElement("span");for(var F=0;F<H.length;F++){var B=K.substr(L,H[F]-L);C.appendChild(document.createTextNode(B));var I=document.createElement("span");I.style.fontWeight="bold";I.style.color="#222222";I.appendChild(document.createTextNode(K.substr(H[F],J.length)));C.appendChild(I);L=H[F]+J.length}if(L<K.length){var B=K.substr(L);C.appendChild(document.createTextNode(B))}D.parentNode.insertBefore(C,D);D.parentNode.removeChild(D);return }if(D.nodeType!=1||D.className.indexOf("editcomment")!=-1||D.className.indexOf("highlighted")!=-1){return }for(var A=D.firstChild;A!=null;){var G=A.nextSibling;highlightNode(A,J,M);A=G}}function pageLoadId(){return(new Date(document.lastModified)).getTime()}function maybeRestoreHtml(){$("input.savedhtml").each(function(F,D){D=$(D);var A=D.parents("div:first");var C=A.attr("feedid");var E=D.val();var G=A.find("input.savedhash").val();var B=A.find("input.savedloadid").val();if(E&&G&&(!pageLoadId()||B==pageLoadId())){dprint("Restoring saved HTML");$("#"+C).html(E);gFeedSpecs[C].hash=G}})}function savePageHtml(){$("input.savedhtml").each(function(E,D){D=$(D);var A=D.parents("div:first");var C=A.attr("feedid");var B=gFeedSpecs[C];D.val($("#"+C).html());A.find("input.savedhash").val(B.hash);A.find("input.savedloadid").val(pageLoadId())})}function saveFriendListChanges(F){var E=F.find("input[name=lists]:checked");var D=[];for(var B=0;B<E.length;B++){D.push(E.get(B).value)}F.find("input[type=submit]").disable();showSpinner(F.find(".l_closedialog"));var C="";var A=$("#newlistname");if($("#fl-new").attr("checked")&&A.val()&&A.val()!=A.attr("title")){C=A.val()}submitForm("/a/updatefriendlists",{lists:D.join(","),stream:F.attr("sid"),newlist:C});return false}var autoRefresher={lastActive:now(),lastRefresh:now(),refreshId:0,lastMaybe:0,activity:function(){autoRefresher.lastActive=now()},start:function(A){dprint("Start auto-refresh "+A);this.refreshInterval=A;$(document).keypress(this.activity).mousemove(this.activity).mousedown(this.activity).scroll(this.activity);setInterval(bind(this,this.maybeRefresh),500)},isSafeToRefresh:function(){if(this.lastActive>now()-120000){return false}if($(".player").find("object,embed").length||$(".expando:visible").length||$('textarea[name="body"]').length){dprint("Not safe to a-r");this.activity();return false}return true},maybeRefresh:function(){var E=now()-this.lastMaybe;if(E>5000){dprint("gap "+E);this.activity()}this.lastMaybe=now();if(this.lastRefresh>now()-this.refreshInterval||!this.isSafeToRefresh()){return }dprint("Auto-refreshing");this.lastRefresh=now();var D=++this.refreshId;for(var C=0;C<gFeedAutoRefresh.length;C++){var A=gFeedAutoRefresh[C];var B=$.extend({id:A,path:location.pathname},gFeedSpecs[A]);$.postJSON("/a/feed?auto=1",B,bind(this,function(F){if(!F||!this.isSafeToRefresh()){return }if(F.reload){document.location.reload()}else{if(F.html&&this.refreshId==D){dprint("Updating "+F.hash);$("#"+F.id).html(F.html);$(".noentries").remove();gFeedSpecs[F.id].hash=F.hash}}}))}}};function submitForm(D,B){var C=$('<form method="post"></form>');C.attr("action",addFBParams(D));C.target="_self";B.next=location.href;B.at=getCookie("AT");for(var A in B){C.append($('<input type="hidden" name="'+A+'"/>').val(B[A]))}$("body").append(C);C.submit()}clickHandlers.expandcomments=function(A){var C=A.parents(".entry");var B=C.find(".hiddencomments");if(B.length){C.find(".expandcomment").remove();B.show();return }$.postJSON("/a/comments",{entry:C.attr("eid"),stream:A.parents(".cluster").attr("sid")},function(D){var F=A.parents(".entry");var E=F.find(".commentform");F.find(".comments").replaceWith(D.html);F.find(".comments").append(E)},A)};clickHandlers.expandmedia=function(A){$.postJSON("/a/entry",{entry:A.parents(".entry").attr("eid"),stream:A.parents(".cluster").attr("sid"),comments:1-A.parents(".entry").find(".l_expandcomments").length,showhide:A.parents(".entry").attr("showhide"),media:1},function(B){A.parents(".entry").replaceWith($(B.html).append(A.parents(".entry").find(".commentform")))},A)};clickHandlers.expandlikes=function(A){$.postJSON("/a/likes",{entry:A.parents(".entry").attr("eid"),stream:A.parents(".cluster").attr("sid")},function(B){A.parents(".entry").find(".likes").replaceWith(B.html)},A.parents(".lbody"))};clickHandlers.expandcluster=function(D){var B=D.parents(".cluster").attr("ceid");var A=D.parents(".feed").attr("id");var C=$.extend({clusterentry:B},gFeedSpecs[A]);$.postJSON("/a/cluster",C,function(E){D.parents(".cluster").replaceWith(E.html).find(".commentform").each(function(){getEntry($(this).parents(".entry").attr("eid")).append(this)})},D)};clickHandlers.editcomment=function(B){var A=B.parents(".entry");var C=B.parents(".comment:first");$.postJSON("/a/getcomment",{entry:A.attr("eid"),comment:C.attr("cid")},function(D){var E=$("<span/>");C.addClass("hiddencomment").hide().after(E);makeCommentForm(E,commentEditSubmit,D.raw_html)},B)};clickHandlers.approvecomment=function(B){var A=B.parents(".entry").attr("eid");var C=B.parents(".comment");$.postJSON("/a/approvecomment",{entry:A,comment:C.attr("cid")},function(D){if(B.parents(".pendingcomment").remove().length==0){C.replaceWith(D.html)}},B)};clickHandlers.deletecomment=function(B){var A=B.parents(".entry").attr("eid");var C=B.parents(".comment");$.postJSON("/a/deletecomment",{entry:A,comment:C.attr("cid"),"delete":"1"},function(D){if(B.parents(".pendingcomment").remove().length==0){C.replaceWith(D.html)}},B)};clickHandlers.undeletecomment=function(A){$.postJSON("/a/deletecomment",{entry:A.attr("eid"),comment:A.attr("cid"),"delete":"0"},function(B){comment=$(B.html);comment.not(".owner").addClass("moderated").find(".content").append('(<a href="#" class="l_deletecomment">'+'delete'+"</a>)");A.parents(".deleted").replaceWith(comment)},A)};clickHandlers.comment=function(D){var C=D.parents(".entry");var B=C.find(".commentform");if(B.length>0){B.find("textarea").focus();return }var A=C.find(".comments");if(!A.length){var E=$('<div class="comments"></div>');C.append(E);A=E}makeCommentForm(A,commentSubmit,"")};function makeCommentForm(E,B,A){var F=$('<div class="commentform"><form method="post"><div class="text"><textarea name="body"></textarea></div><div class="buttons"><input type="submit" value="'+'Post'+'"/><a href="#" class="l_cancelcomment">'+'Cancel'+"</a></div></form></div>");F.find("form").submit(function(){return B(F.find("form"))});F.find("textarea").val(A);E.append(F);if(E.parent(".entry").is(".twitter")){F.find("form").append('<div class="twitbox"></div>');setTweetBackHtml()}var C=F.parents(".entry").find(".comment:first").not(".hiddencomment").length?512:1024;var D=F.find("textarea").makeExpandable(C,function(){if(!F.find("input[type='submit']").attr("disabled")){F.find("textarea").blur();B(F.find("form"))}}).focus().keypress();if($.browser.msie){D.select()}}function setTweetBackHtml(B){var D='<input type="checkbox" id="twitback"/><label for="twitback">';if(gTwitLogin){var C='Also send this comment as an @reply twitter from %(username)s';C=C.replace("%(username)s",gTwitLogin);D+=C+'</label> - <a href="#" class="l_twitlogin">'+'change user'+"</a>"}else{var C='Also send this comment as an @reply twitter';D+=C+"</label>"}D+='<br/><span class="charcount"></span>';var A=$(".twitbox").html(D).find("input[type=checkbox]");A.click(twitCheckbox);if(B){if(gTwitLogin){A.attr("checked","true");A.each(twitCheckbox)}else{A.removeAttr("checked")}}}function doTwitLogin(){var A=gHttpsPrefix+"/account/twitterlogin";if(document.location.protocol=="https:"){A+="?https=1"}$('<div id="dialog" class="twitterlogin" style="width:33.5em"><iframe style="width:33em;height:'+(gTwitLogin?"15":"12")+'em;border-width:0px" frameborder="0" src="'+A+'"></iframe></div>').dialog()}clickHandlers.twitlogin=doTwitLogin;function setTwitLogin(A){gTwitLogin=A;setTweetBackHtml(true);$(".comment textarea").select()}function updateCounter(A,E,B){var C=138-B.length-A[0].value.length;var D='%(count)s remaining';D=D.replace("%(count)s",""+C);E.html(D);if(C<0){E.addClass("error emphasized")}else{E.removeClass("error emphasized")}}function twitCheckbox(){if(gTwitLogin){var A=$(this);var C=A.siblings(".charcount");var B=A.parents(".commentform").find("textarea");if(A.attr("checked")){var E=A.parents(".body:first").find(".summary a[href^='http://twitter.com/']").attr("href").match(/twitter.com\/(.+)$/)[1];updateCounter(B,C,E);var D=setInterval(function(){if(A.attr("checked")){updateCounter(B,C,E)}else{B.unbind("keypress.charcount");clearInterval(D)}},100)}else{C.empty()}}else{doTwitLogin();return false}}clickHandlers.cancelcomment=function(A){A.parents(".commentform").parent().siblings(".hiddencomment").removeClass("hiddencomment").show();A.parents(".commentform").remove()};clickHandlers.like=function(A){like(A.parents(".entry"),false,A.parents("div:first").find("a:last"))};clickHandlers.unlike=function(A){like(A.parents(".entry"),true,A.parents("span"))};function getEntry(A){return $("div[eid="+A+"]")}clickHandlers.reshare=function(G){var B=G.attr("eid");var H=getEntry(B);var C=H.find("a.main");var A={title:(C.length?C:H.find(".title")).text(),url:C.attr("href"),entry:B,images:[]};if(!A.url){A.url=makeEntryLink(H,true)}var F=H.find(".media img.thumbnail");for(var D=0;D<F.length&&D<3;D++){var I=F[D];A.images.push({src:I.src,w:I.width,h:I.height})}window.ff__reshare=A;var E=document.createElement("script");E.setAttribute("type","text/javascript");E.setAttribute("src","/share/bookmarklet/javascript");document.body.appendChild(E)};clickHandlers.moderate=function(C){var A=C.attr("eid");var B=getEntry(A);B.find(".comment").not(".moderated,.owner").addClass("moderated").find(".content").append('(<a href="#" class="l_deletecomment">'+'delete'+"</a>)")};function submitEditEntry(C){if(!checkRequired(C,C.link!=undefined?["title","link"]:["title"])){return false}C=$(C);var A=C.parents(".entry").attr("eid");var B=C.formToDict();B.entry=A;B.save="1";$.postJSON("/a/editentry",B,function(D){getEntry(A).find(".title").html(D.html)},C.find(".l_canceleditentry"));return false}clickHandlers.canceleditentry=function(B){var A=B.parents(".title");A.html(A.attr("oldhtml"))};clickHandlers.editentry=function(B){var A=B.attr("eid");$.postJSON("/a/editentry",{entry:A},function(D){var E=getEntry(A);var C=E.find(".title");C.attr("oldhtml",C.html());C.html(D.html);C.find("textarea").makeExpandable(300,function(F){submitEditEntry($(F).parents("form.editentryform")[0])});C.find("input:first").focus()},getEntry(A).find(".l_more"))};clickHandlers.deleteentry=function(C){var A=C.attr("eid");var B=getEntry(A);$.postJSON("/a/deleteentry",{entry:A,stream:B.parents(".cluster").attr("sid"),"delete":"1"},function(D){getEntry(A).replaceWith(D.html)},B.find(".l_more"))};clickHandlers.undeleteentry=function(A){$.postJSON("/a/deleteentry",{entry:A.attr("eid"),"delete":"0"},function(B){A.parents(".deleted").replaceWith(B.html)},A)};function makeEntryLink(B,C){var A=$.trim(B.find(".title").text().replace(/[^\w]+/g," "));if(A.length>40){A=A.substring(0,50).replace(/^(.*) .*$/,"$1")}A=A.length<4?"":"/"+A.replace(/ /g,"-")+"/";return(C?"http://friendfeed.com":"")+"/e/"+B.attr("eid")+A}clickHandlers.more=function(D){var C=D.parents(".entry");var B=C.attr("eid");var G='<div class="popupmenu" eid="'+B+'">';if(location.pathname.substr(0,3)!="/e/"){G+='<div class="item"><a class="noframe" href="'+makeEntryLink(C)+'">'+'Link to this entry'+"</a></div>"}G+='<div class="item"><a href="#" class="l_reshare" eid="'+B+'">'+'Reshare this entry'+"</a></div>";var A=C.attr("viewinlink");if(A){var E=C.parents(".cluster").find(".icon img").attr("alt");var F='View in %(service_name)s'.replace("%(service_name)s",E);G+='<div class="item"><a class="noframe" href="'+A+'">'+F+"</a></div>"}if(C.hasClass("writable")){if(C.find(".comment").not(".deleted").not(".owner").length){G+='<div class="item"><a href="#" class="l_moderate" eid="'+B+'">'+'Moderate comments'+"</a></div>"}if(C.parents(".cluster").attr("uid")==window.gCurrentUserId){G+='<div class="item"><a href="#" class="l_editentry" eid="'+B+'">'+'Edit this entry'+"</a></div>"}G+='<div class="item"><a href="#" class="l_deleteentry" eid="'+B+'">'+'Delete this entry'+"</a></div>"}G+="</div>";$(G).popupMenu(D)};clickHandlers.hideone=function(B){var A=B.parents(".entry");$.postJSON("/a/hideone",{entry:A.attr("eid"),foaf:A.parents(".cluster").find(".foaf").attr("uid")||"",hide:"1"},function(C){A.replaceWith(C.html)},A.find(".l_more"))};clickHandlers.unhideone=function(B){var A=B.attr("eid")||B.parents(".entry").attr("eid");$.postJSON("/a/hideone",{entry:A,hide:"0"},function(C){B.parents(".hidemore").replaceWith(C.html)},B.parents(".graybox"))};clickHandlers.unhide=function(A){submitForm("/a/hiderule",{rules:A.parents(".entry").attr("unhide")})};clickHandlers.hideclose=function(A){A.parents(".hidemore").find(".hideopen").toggle();A.parents(".hidemore").find(".hideclosed").toggle()};clickHandlers.hideexplain=function(A){A.parents(".hidemore").find(".hideexplain").toggle()};clickHandlers.submithide=function(B){var A=B.parents(".hidemore");var C=A.find("input:checkbox:checked:enabled").attr("rule")||A.find("input:radio:checked").attr("rule");showSpinner(B.parents(".graybox"));submitForm("/a/hiderule",{rules:C})};clickHandlers.hiderule=function(A){showSpinner(A);submitForm("/a/hiderule",{rules:A.attr("hiderules")})};clickHandlers.radiohide=function(C){var A=C.parents(".hidemore");A.find("label.l_checkboxhide").addClass("disabled");A.find("input:checkbox").disable();var B=A.find("input:radio:checked").parent().next().next();if(B.hasClass("l_checkboxhide")){B.removeClass("disabled");B.find("input:checkbox").enable()}return true};clickHandlers.togglehide=function(A){var B=A.parents(".feed");if(B.find(".hiddenentries:visible").length>0){A.css("backgroundImage","url('/static/images/arrow-collapsed"+rtl()+".png?v=2')");B.find(".hiddenentries").hide()}else{A.css("backgroundImage","url('/static/images/arrow-expanded.png?v=2')");B.find(".hiddenentries").show()}};clickHandlers.togglerelated=function(B){var A=B.parents(".cluster");if(A.find(".related:visible").length>0){B.css("backgroundImage","url('/static/images/arrow-collapsed"+rtl()+".png?v=2')");A.find(".related").hide()}else{B.css("backgroundImage","url('/static/images/arrow-expanded.png?v=2')");A.find(".related").show()}};clickHandlers.attachlink=function(A){var B=A.parents(".sharebox").find("div.link,div.promo");B.show();B.find("input").val("http://").select();A.hide()};clickHandlers.attachcomment=function(A){var B=A.parents(".sharebox").find("div.comment");B.show();B.find("input").select();A.hide()};clickHandlers.attachphotos=function(B){var E=B.parents(".sharebox");if(window.fileUploader&&window.fileUploader.available()){multiFileUpload(E);return }var D=E.find("div.photo").length;var A;if(D>0){A=E.find("div.photo:last")}else{A=E.find("div.link");if(A.length==0){A=E.find("div.title")}}E.find(".photo .add").remove();var C=$('<div class="photo field"><input type="file" name="photo'+D+'" class="photo" size="39"/><span class="add"><a href="#" class="l_attachphotos">'+'add another'+"</a></span></div>");C.insertAfter(A);if(D>=9){E.find(".l_attachphotos").hide()}};clickHandlers.changepicture=function(A){$.postJSON("/a/picturedialog",{stream:A.attr("sid"),next:location.href},function(B){$(B.html).dialog().find("#pictureupload").focus()})};function showRoomList(B,A){$.postJSON("/a/roomlist",{user:B.attr("uid")||"",expand:A||"",currentPath:location.pathname||""},function(C){B.parents("div.rooms").replaceWith(C.html)},B)}clickHandlers.expandroomlist=function(A){showRoomList(A,true)};clickHandlers.collapseroomlist=function(A){showRoomList(A,false)};clickHandlers.roomprefs=function(A){$.postJSON("/a/roomprefsdialog",{},function(B){$(B.html).dialog()},A)};function saveRoomPrefs(B){var A=[];B.find("input[type='checkbox']").each(function(D,C){if(C.checked){A.push(C.value)}});submitForm("/a/saveroomprefs",{rooms:A.join(",")});return false}clickHandlers.friendlistnew=function(B){var A=$('<div id="dialog"><div style="margin-bottom:5pt">'+'Friend list name'+'</div><form action="/a/createfriendlist" method="post" onsubmit="return checkRequired(this, [\'name\'])"><div><input type="text" style="width:150px" maxlength="25" name="name" class="name"/></div><div class="buttons"><input class="save" type="submit" value="'+'Create'+'"/><a href="#" class="l_closedialog">'+'Cancel'+'</a><input type="hidden" name="at"/></div></form></div>');A.find("input[name='at']").val(getCookie("AT"));A.dialog();A.find("input.name").select()};clickHandlers.closefriendlist=function(){$(".friendchooser").remove();$(".friendlistedit").show()};clickHandlers.editfriendlist=function(A){$.postJSON("/a/friendlistchooser",{list:A.attr("gid")},function(B){$(".friendchooser").remove();var C=$("#main td.mainsizer").prepend(B.html).find(".friendchooser");C.find("input.nicknames").autoCompleteSubscriptions(true).select();C.find("div.person").mouseover(friendListPersonOver).mouseout(friendListPersonOut);A.parents(".friendlistedit").hide()},A.parents("div:first").find("a:last"))};clickHandlers.deletefriendlist=function(A){if(!confirm('Are you sure you want to delete this friend list?')){return }showSpinner(A.parents(".friendchooser").find(".t"));$.postJSON("/a/deletefriendlist",{list:A.attr("gid")},function(B){document.location=addFBParams("/")})};clickHandlers.friendlistname=function(C){var D=$("h1");var B=D.parents("td:first").find("form");if(B.length>0){B.find("input[type='text']").select();return }var A=$('<form action="/a/friendlistname" method="post" onsubmit="return friendListNameSubmit($(this))"><div class="nameedit"><input type="text" name="name" class="h1" size="25"/> <input type="submit" value="'+'Save'+'"/> <a href="#" class="l_friendlistnamecancel" style="padding-left: 2pt">'+'Cancel'+'</a><input type="hidden" name="list" value="'+C.attr("gid")+'"/></div></form>');D.hide();D.after(A);A.find("input[type='text']").val(D.text()).select()};clickHandlers.friendlistnamecancel=function(A){A.parents("form").remove();$("h1").show()};clickHandlers.deletefromfriendlist=function(B){var A=$.extend(gFeedSpecs.feed1,{list:B.attr("gid"),stream:B.attr("uid")});$.postJSON("/a/deletefromfriendlist",A,function(C){updateFriendList(B.parents(".friendchooser"),C)},B.parents("div.t:first"))};function updateFriendList(B,A){if(A.chooser_html){var C=$(A.chooser_html);B.replaceWith(C);C.find("input.nicknames").autoCompleteSubscriptions(true).select();C.find("div.person").mouseover(friendListPersonOver).mouseout(friendListPersonOut)}if(A.feed_html){$(".noentries").remove();gFeedSpecs.feed1.hash=A.feed_hash;$("#feed1").html(A.feed_html)}}clickHandlers.friendlisttoggle=function(B){var A=B.parents(".item");var C=A.parents(".section").find(".friendlist[gid='"+B.attr("gid")+"']");var D=C.length>0&&C.is(":visible");if(C.length>0){if(D){C.hide()}else{C.show()}}else{if(!D){$.postJSON("/a/friendlistmembers",{list:B.attr("gid")},function(E){var F=B.parents(".tab");if(F.length>0){F.next("div").after(E.html)}else{A.after(E.html)}},A.find("a:last"))}}if(!D){B.addClass("expanded")}else{B.removeClass("expanded")}B.find("img").attr("src",D?"/static/images/arrow-collapsed"+rtl()+".png?v=2":"/static/images/arrow-expanded.png?v=2")};clickHandlers.sharetoggle=function(C){dprint("shareexpand "+now());var B=C.parents(".sharebox");var A=B.find(".expanded");var E=B.find(".collapsed");A.toggle();E.toggle();var D=A.is(":visible")?"1":"";if(D){$(".summarymenu").hide();B.find("textarea").select()}else{$(".summarymenu").show()}if(location.pathname=="/"){$.postJSON("/a/homeshareboxpref",{open:D})}};clickHandlers.play=function(C){var A=C.parent(".container");var D=A.find("div.l_play img");A.parents(".media").find(".player").remove();if(A.attr("playing")){D.attr("src","/static/images/playbutton.png?v=1");A.removeAttr("playing")}else{D.attr("src","/static/images/stopbutton.png?v=1");A.attr("playing",true);var B=A.find("a").attr("play");A.parents(".media").append('<div class="player">'+B+"</div>")}};clickHandlers.audio=function(C){var A=C.parent(".container");A.css("display","none");A.attr("playing",true);var B=A.find("a").attr("play");A.parent().append('<div class="player">'+B+"</div>");return false};clickHandlers.editservice=function(B){var A=B.parents(".editservices");$(".feed").empty();$.postJSON("/a/serviceform",{service:B.attr("service")||"",serviceid:B.attr("serviceid")||"",stream:A.attr("streamid")||"",all:B.attr("showall")||""},function(C){A.replaceWith(C.html);$(".editservices input[type='text']:first").select()},A.find("table:first"))};clickHandlers.editallservices=function(B){var A=B.parents(".editservices");$(".feed").empty();$.postJSON("/a/servicesdialog",{stream:A.attr("streamid")||"",all:1},function(C){A.replaceWith(C.html)},A.find("table:first"))};clickHandlers.canceleditservice=function(B){if(window.gNextCancelUrl){document.location=window.gNextCancelUrl;return }var A=$(".editservices").find("table:first");$(".feed").empty();$.postJSON("/a/servicesdialog",{stream:B.attr("streamid")||"",all:B.attr("showall")||""},function(C){$(".editservices").replaceWith(C.html)},A)};clickHandlers.expandroommembers=function(A){$.postJSON("/a/roommembers",{room:A.attr("room"),expand:1},function(B){A.parents(".section").replaceWith(B.html)},A)};clickHandlers.expandroomadmins=function(A){$.postJSON("/a/roomadmins",{room:A.attr("room"),expand:1},function(B){A.parents(".section").replaceWith(B.html)},A)};clickHandlers.expandusersubs=function(A){$.postJSON("/a/usersubscriptions",{user:A.attr("userid"),expand:1},function(B){A.parents(".section").replaceWith(B.html)},A)};clickHandlers.usersubscribe=function(A){if(!gCurrentUserId){document.cookie="SUB="+A.attr("uid")+"; path=/";document.location=addFBParams("/account/login?next="+encodeURIComponent(location.href))}else{submitForm("/a/usersubscribe",{user:A.attr("uid")})}};clickHandlers.streamsublists=function(A){$.postJSON("/a/friendlistdialog",{stream:A.attr("sid")},function(B){var C=$(B.html).dialog();C.find("input[type=text]").hint();C.find("input[type=submit]").focus()},A)};clickHandlers.userunsubscribe=function(A){submitForm("/a/userunsubscribe",{user:A.attr("uid")})};clickHandlers.forceunsubscribe=function(A){if(!confirm('Are you sure you want to unsubscribe %(name)s from your FriendFeed?'.replace("%(name)s",A.parents(".userbox").find(".name").text()))){return }submitForm("/a/forceunsubscribe",{user:A.attr("uid")})};clickHandlers.roomjoin=function(A){if(!gCurrentUserId){document.cookie="SUB="+A.attr("rid")+"; path=/";document.location=addFBParams("/account/login?next="+encodeURIComponent(location.href))}else{submitForm("/a/roomjoin",{room:A.attr("rid")})}};clickHandlers.roomunjoin=function(A){submitForm("/a/roomunjoin",{room:A.attr("rid")})};clickHandlers.roominvitedialog=function(A){$.postJSON("/a/roominvitedialog",{room:A.attr("rid"),next:location.href},function(B){var C=$(B.html);C.dialog();C.find("textarea[name='nicknames']").autoCompleteSubscriptions().select()},A)};clickHandlers.filterservice=function(B){var A=location.pathname+"?service="+B.attr("servicename");if(B.attr("serviceid")){A+="&serviceid="+B.attr("serviceid")}location.href=addFBParams(A)};clickHandlers.editfriendlists=function(A){$.postJSON("/a/friendlistdialog",{stream:A.attr("sid")},function(B){var C=$(B.html);C.find("input[type=text]").hint();C.dialog()},A)};clickHandlers.userblock=function(A){$.postJSON("/a/blockuserdialog",{user:A.attr("uid"),next:location.href},function(B){$(B.html).dialog()},A)};clickHandlers.userunblock=function(A){submitForm("/a/setblock",{user:A.attr("uid"),next:location.href})};clickHandlers.includefof=function(A){var B=$.extend({list:A.attr("lid"),include:A.attr("checked")?1:""},gFeedSpecs.feed1);$.postJSON("/a/includefof",B,function(C){updateFriendList(A.parents(".friendchooser"),C)},A.parents("div:first").find("span:last"));return true};clickHandlers.closeshare=function(B){var A=B.parents(".sharebox");A.hide();A.siblings(".sharelinks").show();clearShareBox(A)};clickHandlers.sharemessage=function(A){showShareBox(A)};clickHandlers.sharelink=function(A){var B=A.parents(".sharelinks").siblings(".sharebox");B.find("div.link,div.promo").show();B.find("div.link input").val("http://");B.find("a.l_attachlink").hide();showShareBox(A)};clickHandlers.sharephotos=function(A){showShareBox(A,true);var B=A.parents(".sharelinks").siblings(".sharebox");clickHandlers.attachphotos(B.find("a.l_attachphotos"))};clickHandlers.togglesidebar=function(){submitForm("/a/togglesidebar",{})};clickHandlers.setdebuglocale=function(A){submitForm("/a/setdebuglocale",{locale:A.attr("lc")||""})};function showShareBox(C,D){var B=C.parents(".sharelinks");B.hide();var A=B.siblings(".sharebox");A.show();if(!D){A.find("textarea.sharetitle").select().focus()}}var popup={cache:{},counter:0,id:null,mouseover:function(B){var C=$(B).attr("uid");var A=false;if(!C){C=$(B).attr("rid");A=true}if(C==this.id){this.counter++}else{this.hide();this.timeout=setTimeout(function(){popup.timeout=null;popup.counter++;popup.show(B,A)},100)}},mouseout:function(){var B=$("#popup");if(B.css("visibility")!="visible"){this.hide()}else{var A=this.counter;setTimeout(function(){if(popup.counter==A){popup.hide(true)}},150)}},show:function(H,B){var G=$(H);var J="uid";if(B){J="rid"}var D=$(H).attr(J);var I=G.offset();var C={left:0,top:I.top+G.height()};var F=window.gRTL?"r":"l";var A=window.gRTL?"l":"r";var E=$('<div id="popup" class="l_person" '+J+'="'+D+'"><table><tr><td class="t'+F+'"></td><td class="t"></td><td class="t'+A+'"></td></tr><tr><td class="'+F+'"></td><td class="c">'+'Loading...'+'</td><td class="'+A+'"></td></tr><tr><td class="b'+F+'"></td><td class="b"></td><td class="b'+A+'"></td></tr></table></div>').css(C);$("body").append(E);this.id=D;setTimeout(function(){if(D==popup.id){$.closePopupMenu();var K=windowSize();var N=$("#popup");var L=N.find("table:first").width();var M=I.left-10;if(M+L>K.width){N.css("left",K.width-L-25)}else{N.css("left",M)}$("#popup").css("visibility","visible")}},800);this.loadPopup(this.id,B)},hide:function(A){this.counter++;this.id=null;if(this.timeout){clearTimeout(this.timeout);this.timeout=null}if(A&&!$.browser.msie){$("#popup").fadeOut(200,function(){$("#popup").remove()})}else{$("#popup").remove()}},loadPopup:function(D,C){if(this.cache[D]){$("#popup").find(".c").empty().append(this.cache[D]);return }var B="/a/userpopup";var A={user:D};if(C){B="/a/roompopup";A={room:D}}$.postJSON(B,A,function(E){popup.cache[D]=E.html;var F=$("#popup");if(F.length>0&&popup.id==D){F.find(".c").empty().append(popup.cache[D])}})}};mouseoverHandlers.room=bind(popup,"mouseover");mouseoutHandlers.room=bind(popup,"mouseout");mouseoverHandlers.person=bind(popup,"mouseover");mouseoutHandlers.person=bind(popup,"mouseout");var fileUploader={id_:"fileuploader",loaded_:false,callbackCounter_:0,startLoaded_:false,load:function(A){if(this.startLoaded_){return }this.startLoaded_=true;if(navigator.userAgent.indexOf("X11;")!=-1){return }createFlashObj(this.id_,"/static/flash/Uploader.swf?v=2");this.loadCallback_=A},onLoaded:function(){this.loaded_=true;if(this.loadCallback_){this.loadCallback_();this.loadCallback_=null}},available:function(){return(this.loaded_&&this.flash_().showFileDialog)},showFileDialog:function(C,E,F){var A={};for(var D in E||{}){var B="_fileUploaderCallback"+this.callbackCounter_++;window[B]=E[D];A[D]=B}this.flash_().showFileDialog(C,A,F)},numActiveUploads:function(){return this.flash_().numActiveUploads()},flash_:function(){return document.getElementById(this.id_)}};
